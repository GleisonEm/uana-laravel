(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[13],{"748b":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"q-pa-md",staticStyle:{flex:"1","justify-content":"justify-between",overflow:"hidden"}},[s("div",{staticClass:"col-6 q-pa-md",staticStyle:{overflow:"auto",height:"75vh",display:"flex","flex-direction":"column-reverse"}},[s("div",{staticClass:"q-pa-md column-reverse justify-center"},e._l(this.messages,(function(t){return s("div",{key:t.uniqueId,staticStyle:{width:"100%","max-width":"400px"}},[t.userSendId===e.user.data.id?s("q-chat-message",{attrs:{name:"me",avatar:e.getAvatar(t.userSendId),text:[t.message],stamp:t.sendMessageHour,sent:"","bg-color":"amber-7"}}):s("q-chat-message",{attrs:{name:e.personName,avatar:e.getAvatar(t.userSendId),text:[t.message],stamp:t.sendMessageHour,size:"8","text-color":"white","bg-color":"primary"}})],1)})),0)]),s("div",{staticClass:"col-6"},[s("q-input",{attrs:{filled:"","bottom-slots":"",counter:"",maxlength:"500"},scopedSlots:e._u([{key:"append",fn:function(){return[""!==e.text?s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"close"},on:{click:function(t){e.text=""}}}):e._e()]},proxy:!0},{key:"after",fn:function(){return[s("q-btn",{attrs:{round:"",dense:"",flat:"",icon:"send"},on:{click:function(t){return e.sendMessage()}}})]},proxy:!0}]),model:{value:e.text,callback:function(t){e.text=t},expression:"text"}})],1)])},n=[],o=s("a4d6"),i=(s("5132"),s("2a19")),r=s("f938"),c=s("2f62"),d=s("9523"),u=s.n(d),l=s("daa8");class m{constructor(){u()(this,"socket",void 0)}setupSocketConnection(){this.socket=Object(l["io"])("http://localhost:3000",{transports:["websocket"],jsonp:!1})}emit(e,t){this.socket&&this.socket.emit(e,t)}disconnect(){this.socket&&this.socket.disconnect()}addEventListener(e){this.socket||setupSocketConnection(),this.socket.on(e.type,e.callback)}}var h=new m,p={components:{},sockets:{connection:function(){console.log("socket connected KKKKKKKKKKKKKKKKKK")},customEmit:function(e){console.log('this method was fired by the socket server. eg: io.emit("customEmit", data)')}},computed:{...Object(c["c"])({user:"user"})},name:"Chat",data:()=>({text:"",conversationId:"62a0a1bb47cb934ed65425c9",items:[],converse:{},messages:[],publishing:!1,classData:null,loading:!0,name:"",tab:"general",fab1:!0,fab2:!1,personName:""}),created(){h.setupSocketConnection(),this.conversationId=this.$route.params.conversationId,console.log(this.conversationId,"this.$route.params")},beforeUnmount(){h.disconnect()},mounted(){h.addEventListener({type:this.conversationId,callback:e=>{this.messages.find((t=>t.uniqueId===e.uniqueId))||this.messages.push(e)}}),this.getDetailsOfConverse()},methods:{async getDetailsOfConverse(){this.loading=!0;const e=await o["a"].find(this.conversationId);if(!e.success)return i["a"].create({message:e.message,type:"error"}),!1;this.messages=e.messages.map((e=>{var t=new Date(e.createdAt),s=t.toLocaleString("pt-br",{hour:"2-digit",minute:"2-digit"});return{...e,sendMessageHour:s}})).reverse(),this.converse=e.converse;var t=this.converse.participants.find((e=>e.id!==this.$store.state.user.data.id)).name;this.personName=t,document.getElementsByClassName("titlePerson").value=t,this.loading=!1},navigateToCreateConversePrivate(){this.$router.push({name:"ContactsConverse",params:{title:"Nova Conversa"}})},getAvatar(e){return this.converse.participants.find((t=>t.id==e)).avatar},sendMessage(){var e=new Date,t=e.toLocaleString("pt-br",{hour:"2-digit",minute:"2-digit"}),s={userSendId:this.$store.state.user.data.id,uniqueId:r["uuid"].v4(),message:this.text,conversationId:this.conversationId,sendMessageHour:t};this.messages.push(s),h.emit("message",s)}}},v=p,g=s("2877"),f=s("65c6"),b=s("6ac5"),k=s("8169"),x=s("27f9"),y=s("0016"),w=s("9c40"),C=s("eebe"),I=s.n(C),K=Object(g["a"])(v,a,n,!1,null,null,null);t["default"]=K.exports;I()(K,"components",{QToolbar:f["a"],QToolbarTitle:b["a"],QChatMessage:k["a"],QInput:x["a"],QIcon:y["a"],QBtn:w["a"]})}}]);